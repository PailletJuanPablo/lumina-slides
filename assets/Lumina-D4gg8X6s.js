var ye=Object.defineProperty;var ke=(h,e,s)=>e in h?ye(h,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[e]=s;var g=(h,e,s)=>ke(h,typeof e!="symbol"?e+"":e,s);import{m as he,p as fe,J as ee,d as Y,k as b,r as $,l as te,c as f,o as d,b as L,e as W,a as o,u as m,w as se,T as ae,t as j,n as E,E as ve,i as J,K as ne,I as ge,q as be,D as F,A as ie,F as Q,L as re,M as Z}from"./index-C1zI_xxG.js";import{e as oe,u as we,L as xe,g as _e,a as Se,_ as Ce,b as $e,E as Ne,d as Ie,S as Le,f as Ee,s as le,h as Te,i as ce,j as q,k as Pe,V as de,l as ze,m as ue,n as Be,o as We,p as je,q as De,r as He,t as Ae,v as Me,w as Re,x as Fe,c as Je,T as pe,y as Oe,z as Ke,A as Ue,B as Ve,C as qe,D as Ye,F as Ge,G as Xe,H as Qe}from"./SlideNavigator-3kV9GjWQ.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Ze(){const h=ee(oe);if(!h)return;let e=0;const s=300,n=a=>{var y,x;const{options:r}=h.state;if(!r.keyboard||!r.navigation)return;const u=Date.now();if(u-e<s)return;const l=((y=r.keys)==null?void 0:y.next)||[],w=((x=r.keys)==null?void 0:x.prev)||[];l.includes(a.key)?(h.next(),e=u):w.includes(a.key)&&(h.prev(),e=u)};he(()=>{window.addEventListener("keydown",n)}),fe(()=>{window.removeEventListener("keydown",n)})}class et{constructor(){g(this,"handlers",new Map)}on(e,s){this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(s)}off(e,s){const n=this.handlers.get(e);n&&n.delete(s)}emit(e,s){const n=this.handlers.get(e);n&&n.forEach(a=>{try{a(s)}catch(r){console.error(`[LuminaBus] Error in handler for event "${e}":`,r)}})}clear(){this.handlers.clear()}}const P=new et,tt={class:"h-full w-full relative flex flex-col text-white overflow-hidden",style:{"background-color":"var(--lumina-colors-background, #030303)",color:"var(--lumina-colors-text, #ffffff)"}},st={key:0,class:"absolute top-0 right-0 p-6 z-50 flex gap-4 pointer-events-auto"},nt={class:"relative h-full w-full md:w-[450px] bg-[#0a0a0a]/95 border-l border-white/10 shadow-2xl overflow-auto text-left flex flex-col transform transition-transform duration-300"},ot={class:"p-6 pb-2 border-b border-white/5 flex items-center justify-between shrink-0"},at={class:"p-6"},it={class:"text-[10px] font-mono text-green-400 whitespace-pre-wrap"},rt={class:"flex-1 w-full relative overflow-y-auto overflow-x-hidden z-10 scroll-smooth"},lt={key:1,class:"absolute bottom-0 left-0 w-full z-40 px-8 py-6 bg-gradient-to-t from-black/60 via-black/20 to-transparent flex justify-between items-end pointer-events-none"},ct={key:0,class:"pointer-events-auto text-left"},dt={class:"text-[10px] font-bold tracking-[0.2em] uppercase mb-1",style:{color:"var(--lumina-color-muted)"}},ut={class:"flex items-center gap-2 text-sm font-mono",style:{color:"var(--lumina-color-text-safe, var(--lumina-color-text))",opacity:.8}},pt={key:0,class:"h-px w-8",style:{backgroundColor:"var(--lumina-color-text-safe, var(--lumina-color-text))",opacity:.3}},ht={key:1,class:"flex-1"},ft={key:2,class:"pointer-events-auto flex gap-3"},vt=["disabled"],mt=["disabled"],yt=Y({__name:"LuminaDeck",setup(h){const{slide:e,index:s,total:n,next:a,prev:r,options:u}=we(),l=ee(oe),w=b(()=>l.hasNext()),y=b(()=>l.hasPrev()),x=b(()=>{var p,t;return(t=(p=l.state.deck)==null?void 0:p.meta)==null?void 0:t.title}),v=b(()=>l.state.options.ui),T=b(()=>l.state.options.navigation);Ze();const i=$({top:"-20%",left:"-10%"}),D=()=>{const p=(t,c)=>Math.floor(Math.random()*(c-t+1)+t);return{top:`${p(-25,65)}%`,left:`${p(-25,65)}%`}};te(s,(p,t)=>{p===0?i.value={top:"-20%",left:"-10%"}:t!==void 0&&(i.value=D())},{immediate:!0});const S=$({showJson:!1}),z=ee("LuminaEngine"),G=()=>{z&&typeof z.openSpeakerNotes=="function"?z.openSpeakerNotes():(console.warn("Lumina Engine not found or openSpeakerNotes not available"),alert("Speaker notes require the full Lumina Engine environment."))},K=b(()=>u.debug),H=b(()=>!e.value||!e.value.type?null:`layout-${e.value.type}`),X=b(()=>{var p,t,c,k,N,C;return{top:((c=(t=(p=e.value)==null?void 0:p.meta)==null?void 0:t.orbPos)==null?void 0:c.top)||i.value.top,left:((C=(N=(k=e.value)==null?void 0:k.meta)==null?void 0:N.orbPos)==null?void 0:C.left)||i.value.left}}),A=p=>{P.emit("action",p)},U=(p,t)=>{const c=p;c.style.opacity="1",t()},V=(p,t)=>{var I,M,R;const{options:c}=l.state;if(((I=c.animation)==null?void 0:I.enabled)===!1){t();return}const k=((M=c.animation)==null?void 0:M.durationOut)||.5,N=((R=c.animation)==null?void 0:R.type)||"cascade",C=_e.timeline({onComplete:t});N==="fade"?C.to(p,{opacity:0,duration:k}):N==="zoom"?C.to(p,{opacity:0,scale:1.1,duration:k}):C.to(p,{opacity:0,y:-20,duration:k,ease:"power2.in"})};return(p,t)=>{var c,k,N,C,I,M,R;return d(),f("div",tt,[L(xe,{"orb-color":(k=(c=m(e))==null?void 0:c.meta)==null?void 0:k.orbColor,"orb-pos":X.value},null,8,["orb-color","orb-pos"]),K.value?(d(),f("div",st,[o("button",{onClick:t[0]||(t[0]=B=>S.value.showJson=!S.value.showJson),class:"w-8 h-8 rounded-full glass-panel flex items-center justify-center text-gray-400 hover:text-white transition",title:"JSON"},[...t[6]||(t[6]=[o("i",{class:"fa-solid fa-code text-xs"},null,-1)])])])):W("",!0),L(ae,{name:"fade"},{default:se(()=>[S.value.showJson?(d(),f("div",{key:0,class:"fixed inset-0 z-[100] flex justify-end",onClick:t[3]||(t[3]=ve(B=>S.value.showJson=!1,["self"]))},[o("div",{class:"absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity",onClick:t[1]||(t[1]=B=>S.value.showJson=!1)}),o("div",nt,[o("div",ot,[t[8]||(t[8]=o("span",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest"},"Slide Data",-1)),o("button",{onClick:t[2]||(t[2]=B=>S.value.showJson=!1),class:"w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-white/50 hover:text-white transition"},[...t[7]||(t[7]=[o("i",{class:"fa-solid fa-xmark"},null,-1)])])]),o("div",at,[o("pre",it,j(JSON.stringify(m(e),null,2)),1)])])])):W("",!0)]),_:1}),o("main",rt,[L(ae,{css:!1,onLeave:V,onEnter:U,mode:"out-in"},{default:se(()=>[H.value?(d(),J(ne(H.value),{key:m(s),data:m(e),onAction:A,class:"min-h-full w-full"},null,40,["data"])):W("",!0)]),_:1})]),(N=v.value)!=null&&N.visible?(d(),f("div",lt,[(C=v.value)!=null&&C.showSlideCount?(d(),f("div",ct,[o("h2",dt,j(x.value),1),o("div",ut,[o("span",null,j((m(s)+1).toString().padStart(2,"0")),1),(I=v.value)!=null&&I.showProgressBar?(d(),f("div",pt)):W("",!0),o("span",null,j(m(n).toString().padStart(2,"0")),1)])])):(d(),f("div",ht)),(M=v.value)!=null&&M.showControls?(d(),f("div",ft,[(R=m(e))!=null&&R.notes?(d(),f("button",{key:0,onClick:G,class:"w-12 h-12 rounded-full glass-panel hover:bg-white/10 flex items-center justify-center transition active:scale-95",title:"Open Speaker View"},[...t[9]||(t[9]=[o("i",{class:"fa-solid fa-person-chalkboard text-sm text-gray-400 hover:text-white"},null,-1)])])):W("",!0),o("button",{onClick:t[4]||(t[4]=(...B)=>m(r)&&m(r)(...B)),class:E(["w-12 h-12 rounded-full glass-panel hover:bg-white/10 flex items-center justify-center transition active:scale-95",!y.value||!T.value?"opacity-30 cursor-not-allowed":""]),disabled:!y.value||!T.value},[...t[10]||(t[10]=[o("i",{class:"fa-solid fa-arrow-left"},null,-1)])],10,vt),o("button",{onClick:t[5]||(t[5]=(...B)=>m(a)&&m(a)(...B)),class:E(["w-12 h-12 rounded-full bg-white text-black hover:scale-105 flex items-center justify-center transition shadow-lg active:scale-95",!w.value||!T.value?"opacity-30 cursor-not-allowed":""]),disabled:!w.value||!T.value},[...t[11]||(t[11]=[o("i",{class:"fa-solid fa-arrow-right"},null,-1)])],10,mt)])):W("",!0)])):W("",!0)])}}}),kt={class:"flex flex-col w-full h-screen bg-black text-white font-sans overflow-hidden"},gt={class:"flex flex-1 overflow-hidden relative"},bt={class:"w-72 bg-[#111] border-l border-[#333] flex flex-col"},wt=Y({__name:"LuminaStudio",setup(h){const e=Se();return ge(Ee,e),(s,n)=>(d(),f("div",kt,[L(Ce),o("div",gt,[L($e),L(Ne),o("div",bt,[L(Ie)]),L(Le)])]))}}),_=class _{constructor(e){g(this,"channel",null);g(this,"handlers",new Set);g(this,"lastTimestamp",0);g(this,"heartbeatInterval",null);g(this,"isConnected",!1);g(this,"connectionHandlers",new Set);this.channelName=e,this.initChannel()}static getInstance(e,s=!1){return s?new _(e):(_.instances.has(e)||_.instances.set(e,new _(e)),_.instances.get(e))}static isSupported(){return typeof BroadcastChannel<"u"}initChannel(){if(!_.isSupported()){console.warn("[SpeakerChannel] BroadcastChannel not supported in this environment");return}try{this.channel=new BroadcastChannel(this.channelName),this.channel.onmessage=e=>{const s=e.data;if(!(s.timestamp&&s.timestamp===this.lastTimestamp)){if(s.action==="ping"){this.send({action:"pong"}),this.handlers.forEach(n=>{try{n(s)}catch(a){console.error("[SpeakerChannel] Handler error:",a)}});return}if(s.action==="pong"){this.setConnected(!0);return}if(s.action==="close"){this.setConnected(!1);return}this.handlers.forEach(n=>{try{n(s)}catch(a){console.error("[SpeakerChannel] Handler error:",a)}})}},this.channel.onmessageerror=e=>{console.error("[SpeakerChannel] Message error:",e)},this.startHeartbeat()}catch(e){console.error("[SpeakerChannel] Failed to initialize:",e)}}send(e){if(!this.channel)return;const s={...e,timestamp:Date.now(),channelId:this.channelName};this.lastTimestamp=s.timestamp,this.channel.postMessage(s)}subscribe(e){return this.handlers.add(e),()=>this.handlers.delete(e)}onConnectionChange(e){return this.connectionHandlers.add(e),e(this.isConnected),()=>this.connectionHandlers.delete(e)}get connected(){return this.isConnected}ping(){this.send({action:"ping"})}notifyClose(){this.send({action:"close"})}startHeartbeat(){this.ping(),this.heartbeatInterval=setInterval(()=>{(this.handlers.size>0||this.connectionHandlers.size>0)&&this.ping()},5e3)}setConnected(e){this.isConnected!==e&&(this.isConnected=e,this.connectionHandlers.forEach(s=>s(e)))}destroy(){this.notifyClose(),this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.channel&&(this.channel.close(),this.channel=null),this.handlers.clear(),this.connectionHandlers.clear(),_.instances.delete(this.channelName)}static destroyAll(){_.instances.forEach(e=>e.destroy()),_.instances.clear()}};g(_,"instances",new Map);let O=_;const xt={class:"speaker-notes"},_t={class:"sn-header"},St={class:"sn-status"},Ct={class:"sn-slide-count"},$t={class:"sn-content"},Nt={class:"sn-notes-section"},It=["innerHTML"],Lt={key:1,class:"sn-notes-empty"},Et={class:"sn-footer"},Tt={class:"sn-nav-controls"},Pt=["disabled"],zt={class:"sn-timer-value"},Bt=["disabled"],Wt=Y({__name:"LuminaSpeakerNotes",props:{channelId:{}},setup(h){const e=h,s=$(0),n=$(0),a=$(""),r=$(null),u=$(!1),l=$(null),w=$(0),y=$(!1),x=$(null),v=b(()=>n.value===0?"No slides loaded":`Slide ${s.value+1} / ${n.value}`),T=b(()=>{const t=Math.floor(w.value/3600),c=Math.floor(w.value%3600/60),k=w.value%60;return t>0?`${t.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`:`${c.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`}),i=b(()=>s.value<n.value-1),D=b(()=>s.value>0);function S(t){return t?t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/__(.*?)__/g,"<strong>$1</strong>").replace(new RegExp("(?<!\\*)\\*(?!\\*)(.*?)(?<!\\*)\\*(?!\\*)","g"),"<em>$1</em>").replace(new RegExp("(?<!_)_(?!_)(.*?)(?<!_)_(?!_)","g"),"<em>$1</em>").replace(/\n/g,"<br>").replace(/^[-*]\s+(.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/gs,"<ul>$1</ul>").replace(/<\/ul>\s*<ul>/g,""):""}function z(){const t=new URLSearchParams(window.location.search),c=e.channelId||t.get("channel")||"lumina-speaker-default";l.value=O.getInstance(c,!0),l.value.onConnectionChange(I=>{u.value=I}),l.value.subscribe(G);let k=0;const N=10,C=setInterval(()=>{var I;if(n.value>0||k>=N){clearInterval(C);return}(I=l.value)==null||I.ping(),k++},300);l.value.ping()}function G(t){switch(t.action){case"state":t.index!==void 0&&(s.value=t.index),t.totalSlides!==void 0&&(n.value=t.totalSlides),t.currentNotes!==void 0&&(a.value=t.currentNotes),t.nextSlidePreview&&(r.value=t.nextSlidePreview);break;case"goto":t.index!==void 0&&(s.value=t.index);break}}function K(){var t;i.value&&((t=l.value)==null||t.send({action:"next"}))}function H(){var t;D.value&&((t=l.value)==null||t.send({action:"prev"}))}function X(){y.value||(y.value=!0,x.value=setInterval(()=>{w.value++},1e3))}function A(){y.value=!1,x.value&&(clearInterval(x.value),x.value=null)}function U(){y.value?A():X()}function V(){A(),w.value=0}function p(t){switch(t.key){case"ArrowRight":case" ":case"Enter":t.preventDefault(),K();break;case"ArrowLeft":case"Backspace":t.preventDefault(),H();break;case"t":case"T":t.preventDefault(),U();break;case"r":case"R":if(t.ctrlKey||t.metaKey)return;t.preventDefault(),V();break}}return he(()=>{z(),window.addEventListener("keydown",p),window.addEventListener("beforeunload",()=>{var t;(t=l.value)==null||t.notifyClose()})}),fe(()=>{var t;A(),window.removeEventListener("keydown",p),(t=l.value)==null||t.destroy()}),(t,c)=>(d(),f("div",xt,[o("header",_t,[c[0]||(c[0]=be('<div class="sn-title" data-v-63b98fd9><svg class="sn-logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-63b98fd9><path d="M12 2L2 7l10 5 10-5-10-5z" data-v-63b98fd9></path><path d="M2 17l10 5 10-5" data-v-63b98fd9></path><path d="M2 12l10 5 10-5" data-v-63b98fd9></path></svg><span data-v-63b98fd9>Lumina Speaker Notes</span></div>',1)),o("div",St,[o("span",{class:E(["sn-indicator",{connected:u.value}])},null,2),o("span",Ct,j(v.value),1)])]),o("main",$t,[o("section",Nt,[c[2]||(c[2]=o("h2",{class:"sn-section-title"},"Notes",-1)),a.value?(d(),f("div",{key:0,class:"sn-notes-content",innerHTML:S(a.value)},null,8,It)):(d(),f("div",Lt,[...c[1]||(c[1]=[o("p",null,"No notes for this slide",-1)])]))])]),o("footer",Et,[o("div",Tt,[o("button",{class:"sn-btn sn-btn-nav",disabled:!D.value,onClick:H,title:"Previous (← or Backspace)"},[...c[3]||(c[3]=[o("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("polyline",{points:"15 18 9 12 15 6"})],-1),o("span",null,"Prev",-1)])],8,Pt),o("div",{class:"sn-timer",onClick:U,title:"Click to start/pause (T)"},[o("span",{class:E(["sn-timer-icon",{running:y.value}])},j(y.value?"⏸":"▶"),3),o("span",zt,j(T.value),1),o("button",{class:"sn-timer-reset",onClick:ve(V,["stop"]),title:"Reset timer (R)"},"↻")]),o("button",{class:"sn-btn sn-btn-nav sn-btn-primary",disabled:!i.value,onClick:K,title:"Next (→, Space, or Enter)"},[...c[4]||(c[4]=[o("span",null,"Next",-1),o("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("polyline",{points:"9 18 15 12 9 6"})],-1)])],8,Bt)])])]))}}),jt=me(Wt,[["__scopeId","data-v-63b98fd9"]]),Dt=Y({__name:"LayoutFlex",props:{data:{}},emits:["action"],setup(h,{emit:e}){const s=h,n=e,a=b(()=>({padding:le[s.data.padding||"none"]})),r=b(()=>s.data.direction==="vertical"?"flex-col":"flex-row"),u=b(()=>({gap:le[s.data.gap||"none"]})),l=v=>ue(v,s.data.direction==="vertical"),w=v=>({...ue(v,s.data.direction==="vertical"),...Be(v)}),y=v=>{n("action",v),P.emit("action",v)},x=v=>({title:Fe,text:Re,image:ce,video:de,bullets:Me,ordered:Ae,button:He,timeline:De,stepper:je,spacer:We})[v]||"div";return(v,T)=>(d(),J(Te,{data:h.data},{default:se(()=>[o("div",{class:"flex-layout w-full min-h-screen flex items-center justify-center",style:F(a.value)},[o("div",{class:E(["flex w-full h-full max-w-7xl mx-auto",r.value]),style:F(u.value)},[(d(!0),f(Q,null,ie(h.data.elements,(i,D)=>(d(),f(Q,{key:D},[i.type==="image"?(d(),J(ce,{key:0,src:i.src,alt:i.alt,fill:i.fill,rounded:i.rounded,"container-class":m(q)(i.size),"container-style":l(i)},null,8,["src","alt","fill","rounded","container-class","container-style"])):i.type==="video"?(d(),f("div",{key:1,class:E(m(q)(i.size)),style:F(l(i))},[L(de,{class:E(m(Pe)(i.rounded,i.fill)),src:i.src,poster:i.poster,autoplay:i.autoplay??!1,loop:i.loop??!1,muted:i.muted??!1,controls:i.controls??!0,"object-fit":i.fill!==!1?"cover":"contain"},null,8,["class","src","poster","autoplay","loop","muted","controls","object-fit"])],6)):i.type==="content"?(d(),f("div",{key:2,class:E(["flex flex-col h-full",m(q)(i.size)]),style:F(w(i))},[(d(!0),f(Q,null,ie(i.elements,(S,z)=>(d(),J(ne(x(S.type)),re({key:z,ref_for:!0},S,{onAction:y}),null,16))),128))],6)):(d(),f("div",{key:3,class:E(m(q)(i.size)),style:F(m(ze)())},[(d(),J(ne(x(i.type)),re({ref_for:!0},i,{onAction:y}),null,16))],6))],64))),128))],6)],4)]),_:1},8,["data"]))}}),Ht=me(Dt,[["__scopeId","data-v-411c492e"]]);class Jt{constructor(e,s={}){g(this,"app");g(this,"store");g(this,"speakerWindow",null);g(this,"speakerChannel",null);g(this,"speakerChannelId");g(this,"speakerUnsubscribe",null);this.selector=e,this.speakerChannelId=`lumina-speaker-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,this.store=Je(s),s.theme&&pe.inject(s.theme),this.app=s.studio?Z(wt):Z(yt),this.app.provide(oe,this.store),this.app.provide("LuminaEngine",this),te(()=>this.store.state.currentIndex,(n,a)=>{var u;const r=(u=this.store.state.deck)==null?void 0:u.slides[n];r&&P.emit("slideChange",{index:n,previousIndex:a??0,slide:r})}),te(()=>{var n;return(n=this.store.state.deck)==null?void 0:n.meta},n=>{if(n){const a={colors:n.colors,typography:n.typography,spacing:n.spacing,borderRadius:n.borderRadius,effects:n.effects,components:n.components},r=n.theme||"default";pe.inject(r,a),n.orbColor&&document.documentElement.style.setProperty("--lumina-colors-primary",n.orbColor)}},{deep:!0}),this.app.component("layout-statement",Oe),this.app.component("layout-half",Ke),this.app.component("layout-features",Ue),this.app.component("layout-timeline",Ve),this.app.component("layout-steps",qe),this.app.component("layout-flex",Ht),this.app.component("layout-auto",Ye),this.app.component("layout-custom",Ge),this.app.component("layout-chart",Xe),this.app.component("layout-video",Qe),P.on("action",n=>{this.store.recordAction(n)}),this.app.mount(this.selector),this.syncSpeakerNotes()}load(e){this.store.loadDeck(e),P.emit("ready",e),this.syncSpeakerNotes()}patch(e){this.store.patchDeck(e),this.syncSpeakerNotes()}exportState(){const{currentIndex:e,deck:s,actionHistory:n}=this.store.state,a=s==null?void 0:s.slides[e],r=n.map(l=>`User ${l.type}ed on ${l.label||l.value}`).join(" -> "),u=n.length>5?"High Engagement":"Low Engagement";return Object.freeze({status:"active",currentSlide:{index:e,id:(a==null?void 0:a.id)||e,type:a==null?void 0:a.type,title:(a&&"title"in a?a.title:null)||"(No Title)"},narrative:`User is currently on slide ${e+1}. Session Flow: ${r||"Just started"}.`,engagementLevel:u,history:[...n]})}on(e,s){P.on(e,s)}off(e,s){P.off(e,s)}destroy(){this.closeSpeakerNotes(),this.app&&this.app.unmount(),P.clear()}get currentSlideIndex(){return this.store.state.currentIndex}goTo(e){this.store.goto(e),this.syncSpeakerNotes()}next(){this.store.next(),this.syncSpeakerNotes()}prev(){this.store.prev(),this.syncSpeakerNotes()}openSpeakerNotes(){if(this.speakerWindow&&!this.speakerWindow.closed)return this.speakerWindow.focus(),this.speakerWindow;if(!O.isSupported())return console.error("[Lumina] BroadcastChannel not supported."),null;const e=600,s=800,n=window.screenX+window.outerWidth,a=window.screenY;if(this.speakerWindow=window.open("about:blank",`lumina-speaker-notes-${this.speakerChannelId}`,`width=${e},height=${s},left=${n},top=${a},resizable=yes,scrollbars=yes`),!this.speakerWindow)return console.warn("[Lumina] Popup blocked."),null;const r=this.speakerWindow;return r.document.open(),r.document.write(`
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <title>Speaker Notes - Lumina</title>
                <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
            </head>
            <body>
                <div id="speaker-notes-root"></div>
            </body>
            </html>
        `),r.document.close(),setTimeout(()=>{if(r.closed)return;Array.from(document.querySelectorAll('style, link[rel="stylesheet"]')).forEach(l=>{r.document.head.appendChild(l.cloneNode(!0))});const u=r.document.getElementById("speaker-notes-root");if(u){const l=Z(jt,{channelId:this.speakerChannelId});l.mount(u),r.addEventListener("unload",()=>l.unmount())}},0),this.initSpeakerChannel(),this.speakerWindow}closeSpeakerNotes(){this.speakerUnsubscribe&&(this.speakerUnsubscribe(),this.speakerUnsubscribe=null),this.speakerChannel&&(this.speakerChannel.notifyClose(),this.speakerChannel.destroy(),this.speakerChannel=null),this.speakerWindow&&!this.speakerWindow.closed&&this.speakerWindow.close(),this.speakerWindow=null}get isSpeakerNotesOpen(){return this.speakerWindow!==null&&!this.speakerWindow.closed}initSpeakerChannel(){this.speakerChannel=O.getInstance(this.speakerChannelId),this.speakerUnsubscribe=this.speakerChannel.subscribe(s=>{switch(s.action){case"next":this.next();break;case"prev":this.prev();break;case"goto":s.index!==void 0&&this.goTo(s.index);break;case"ping":this.syncSpeakerNotes();break}}),this.syncSpeakerNotes();const e=setInterval(()=>{var s;(s=this.speakerWindow)!=null&&s.closed&&(clearInterval(e),this.closeSpeakerNotes())},1e3)}syncSpeakerNotes(){if(!this.speakerChannel)return;const{currentIndex:e,deck:s}=this.store.state;if(!s)return;const n=s.slides[e],a=s.slides[e+1],r=u=>{if(u&&"title"in u&&typeof u.title=="string")return u.title};this.speakerChannel.send({action:"state",index:e,totalSlides:s.slides.length,currentNotes:n==null?void 0:n.notes,nextSlidePreview:a?{title:r(a),type:a.type}:void 0})}}export{Jt as L};
